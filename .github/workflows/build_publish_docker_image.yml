name: Docker beta build

on:
    push:
      branches:
        - master

jobs:
    build:
        if: github.repository == 'rclone/rclone'
        runs-on: ubuntu-latest
        name: Build image job
        steps:
            - name: Checkout master
              uses: actions/checkout@v3
              with:
                fetch-depth: 0
            - name: Build and publish image
              uses: docker/dockerd@latest
              with:
                tag: beta
                imageName: rclone/rclone
                platform: linux/amd64,linux/386
                publish: true
                dockerHubUser: ${{ secrets.DOCKER_HUB_USER }}
                dockerHubPassword: ${{ secrets.DOCKER_HUB_PASSWORD }}
